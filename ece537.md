# ECE537: Communication Networks
## Client-Server
**Structure:**
<br>
Client <--> Router <--> ISP <--> Backbone network <--> Server

## Network Switching
- Circuit Switching
    - Physically change path between endpoints (first manually, eventually automatically)
    - Pros:
        - Dedicated Connections
        - Less interruption
        - Continuous Access to entire resource
    - Cons:
      - Not scalable (expensive)
      - Resource allocation delay
      - Time inefficient
      - Fairness in resource allocation
- Packet Switching
  - Send network and hope it gets to the destination
  - Best effort service
  - Each node acts as new source
  - Sender packetizes data and sends packets individually
  - Packets contain:
    - Who is sending
    - Final destination
    - Who to send to next
  - Pros:
    - No resource allocation
    - Maximize efficiency of network
    - Scalable
  - Cons:
    - Many delays since resources are preallocated
  - Performance metrics
    - Throughput 
    - Delay
  - Routing vs Forwarding
    - Routing - what node is next
    - Forwarding - through which port am i sending the packet

## Delays
  - Types of delay
    - Processing delay
      - Routers speed to take in, route, and forward a packet
      - Only dependent on router
    - Propogation delay
      - Speed at which the physical medium can transport data
      - Distance between endpoints
    - Transmission time
      - Output rate of router
      - Length of packet
    - Queuing delay
      - Time spent in buffer
      - Determined by input and output rate of router as well as the size of the buffer

## Throughput
  - Instantaneous throughput
    - Throughput at given time
  - Average throughput
    - Average throughput across period of time

## Protocol Architecture
  - 5 Layers of networking protocols
    - Application
    - Transport
    - Network
    - Link
    - Physical
  - Application
    - Packetizes message
  - Transport
    - Adds header to packet with info on how to send packet
  - Network
    - Adds header with network protocol info (ip and stuff)
  - Link
    - Adds link header with info to avoid collisions
  - Physical
    - Adds physical header with info to use medium

## Application Layer Protocol
  - HTTP, DNS, Mail Service
  - HTTP - HyperText Transfer Protocol
    - Each conversation starts with a request from client
    - Server then responds
    - Persistant or non-persistant
  - DNS - Domain name service
    - How we get ip address from URL
    - Not terrible if packets is lost - uses unreliable transport layer
    - Uses UDP
    - Still needs to know server IP and port# (usually 53)
    - Architecture:
      - Cannot be centralized
      - 13 root servers in the world
      - TLD (top level domain servers) 
        - last three letters (.edu, .com, .gov)
      - Authoratative servers
        - UsSually where the site is hosted
    - Iterative querying
      - Client requests each level of hierarchy to get ip address
    - Recursive querying
      - Query flows directly from client through hierarchy and back to client
  - FTP - File Transfer Protocol
    - Transfer file to/from remote host
    - Client/server model
    - TCP
    - Requires two connections
      - Control and data
  - Email
    - Communication between multiple user agents and mail servers
    - Clients communicate with mail servers, mail servers communicate with other mail servers
    - SMTP is used for inter-server communication and pushing from client to server
    - Many different protocols for pulling from server to client (mail access protocols)
      - Post Office Protocol (POP)
        - Multiple devices cannot sync to server
      - Internet Mail Access Protocol (IMAP)
        - All messages stay on server
        - State is maintained
      - HTTP

## Peer to Peer (P2P)
- Clients can help other clients download a file by sending a piece of what they've already downloaded

## Transport Layer Protocol
- Protocol that takes a message (letter) and delivers it it to the network layer (post office)
- On the receiving end, transport layer delivers message from network to the correct process
- TCP
  - Stop and wait
    - Does not send new packet until ack is received
    - Resends packet after timeout if ack not received
  - Pipelining
    - Send multiple packets before first ack received
    - Go-Back-N
      - If receiver cannot handle out of order packets, when packet is lost, entire window is sent again
      - Cummulative Ack
        - Receiver will send one acknowledgement for N packets.
        - Helpful when acknowledgements are lost
    - Selective repeat
      - Sends nack for missed packets
      - Sender will resend those packets
      - Window size <= Packet ID / 2
    - Connections
      - Three way handshake
        - Syn packet from client to server
        - Syn-Ack from server to client after allocating resources
        - Final ack from client to server
      - Full duplex
      - First packet gets random sequence number
        - Sequence number corresponds to byte
      - First contains expected sequence number of next packet (sync sequence number + 1 + size of first packet)
    - Flow control
      - Only send as many packets as your server can receive
      - Senders window must be <= Receiver window
      - Flow control is to prevent packet loss at the receiver
    - Congestion control
      - Limits sender window with certain algorithms
      - Slow start
        - Start with congestion window size of 1
        - Increase congestion window size for every acknowledgement
        - Each connection has a slow start (SS) threshold
          - If window size gets greater than or equal to this threshold, can only increase by one each round trip time. (grows linearly, not exponentially)
        - When we see packet loss:
          - Tahoe 
            - Due to timeout
              - Go back to window size of 1
              - Set SS thresh to previous window / 2
            - Due to three duplicate acks
              - In congestion avoidance:
                - Set SS thresh to previous window / 2
                - Set window to SS thresh
          - Reno - not great for multiple packets
            - Due to timeout
              - Same as Tahoe
              - Restart at windows size of 1
              - Set SS thresh to previous window / 2
            - Due to three or more duplicate acks
              - Enter fast recovery
                - SS thresh = window size / 2
                - Artifically inflate window
                  - Wa = window / 2 + #dup acks
                - Exit fast recovery receiving ack for lost packet
                  - window = SS threshold
          - New Reno
            - Same as Reno but only exit recovery if all packets in original window are ack'd
            - Increase artificial window by one for each duplicate ack received
            - Slide artificial window forward to next unack'd packet
    - Actual window is <= min(receiver window, congestion window)
    - 